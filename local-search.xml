<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>标题</title>
    <link href="/2025/04/28/README/"/>
    <url>/2025/04/28/README/</url>
    
    <content type="html"><![CDATA[<h1 id="once"><a href="#once" class="headerlink" title="once"></a>once</h1><p>Only call a function once.</p><h2 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> once = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;once&#x27;</span>)<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">load</span> (<span class="hljs-params">file, cb</span>) &#123;<br>  cb = <span class="hljs-title function_">once</span>(cb)<br>  loader.<span class="hljs-title function_">load</span>(<span class="hljs-string">&#x27;file&#x27;</span>)<br>  loader.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;load&#x27;</span>, cb)<br>  loader.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;error&#x27;</span>, cb)<br>&#125;<br></code></pre></td></tr></table></figure><p>Or add to the Function.prototype in a responsible way:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// only has to be done once</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;once&#x27;</span>).<span class="hljs-title function_">proto</span>()<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">load</span> (<span class="hljs-params">file, cb</span>) &#123;<br>  cb = cb.<span class="hljs-title function_">once</span>()<br>  loader.<span class="hljs-title function_">load</span>(<span class="hljs-string">&#x27;file&#x27;</span>)<br>  loader.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;load&#x27;</span>, cb)<br>  loader.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;error&#x27;</span>, cb)<br>&#125;<br></code></pre></td></tr></table></figure><p>Ironically, the prototype feature makes this module twice as<br>complicated as necessary.</p><p>To check whether you function has been called, use <code>fn.called</code>. Once the<br>function is called for the first time the return value of the original<br>function is saved in <code>fn.value</code> and subsequent calls will continue to<br>return this value.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> once = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;once&#x27;</span>)<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">load</span> (<span class="hljs-params">cb</span>) &#123;<br>  cb = <span class="hljs-title function_">once</span>(cb)<br>  <span class="hljs-keyword">var</span> stream = <span class="hljs-title function_">createStream</span>()<br>  stream.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;data&#x27;</span>, cb)<br>  stream.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (!cb.<span class="hljs-property">called</span>) <span class="hljs-title function_">cb</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;not found&#x27;</span>))<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="once-strict-func"><a href="#once-strict-func" class="headerlink" title="once.strict(func)"></a><code>once.strict(func)</code></h2><p>Throw an error if the function is called twice.</p><p>Some functions are expected to be called only once. Using <code>once</code> for them would<br>potentially hide logical errors.</p><p>In the example below, the <code>greet</code> function has to call the callback only once:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span> (<span class="hljs-params">name, cb</span>) &#123;<br>  <span class="hljs-comment">// return is missing from the if statement</span><br>  <span class="hljs-comment">// when no name is passed, the callback is called twice</span><br>  <span class="hljs-keyword">if</span> (!name) <span class="hljs-title function_">cb</span>(<span class="hljs-string">&#x27;Hello anonymous&#x27;</span>)<br>  <span class="hljs-title function_">cb</span>(<span class="hljs-string">&#x27;Hello &#x27;</span> + name)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span> (<span class="hljs-params">msg</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg)<br>&#125;<br><br><span class="hljs-comment">// this will print &#x27;Hello anonymous&#x27; but the logical error will be missed</span><br><span class="hljs-title function_">greet</span>(<span class="hljs-literal">null</span>, <span class="hljs-title function_">once</span>(msg))<br><br><span class="hljs-comment">// once.strict will print &#x27;Hello anonymous&#x27; and throw an error when the callback will be called the second time</span><br><span class="hljs-title function_">greet</span>(<span class="hljs-literal">null</span>, once.<span class="hljs-title function_">strict</span>(msg))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
